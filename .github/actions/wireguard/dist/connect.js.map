{"version":3,"file":"connect.js","sources":["../src/connect.js"],"sourcesContent":["import * as core from \"@actions/core\";\nimport * as exec from \"@actions/exec\";\nimport * as io from \"@actions/io\";\nimport * as fs from \"fs\";\n\ntry {\n  // const vpnConfig = core.getInput(\"vpn_config\");\n  // core.info(`Wireguard config: ${vpnConfig}`);\n  const confDir = core.getInput(\"conf_dir\");\n  core.info(`Wireguard config directory: ${confDir}`);\n  const privateKey = core.getInput(\"private_key\");\n  const publicKey = core.getInput(\"public_key\");\n  core.info(`Wireguard public key: ${publicKey}`);\n  const endpoint = core.getInput(\"endpoint\");\n  core.info(`Wireguard endpoint: ${endpoint}`);\n  const allowedIps = core.getInput(\"allowed_ips\");\n  core.info(`Wireguard allowed IPs: ${allowedIps}`);\n  const clientIp = core.getInput(\"client_ip\");\n  core.info(`Wireguard client IP: ${clientIp}`);\n  const gatewayIp = core.getInput(\"gateway_ip\");\n  core.info(`Wireguard gateway IP: ${gatewayIp}`);\n\n  core.info(`Installing wireguard`);\n  await exec.exec('sudo', ['apt-get', '-y',\n    '-qq', '-o', 'Dpkg::Progress-Fancy=\"0\"', '-o', 'APT::Color=\"0\"', '-o', 'Dpkg::Use-Pty=\"0\"',\n    'install', 'wireguard', 'wireguard-tools']);\n  await io.mkdirP(confDir);\n  fs.writeFileSync(`${confDir}/privatekey`, privateKey, { mode: 0o600 });\n\n  core.info(`Connecting`);\n  // await exec.exec('sudo', ['wg-quick', 'up', `${confDir}/wg0.conf`]);\n\n  await exec.exec('sudo', ['ip', 'link', 'add', 'dev', 'wg0', 'type', 'wireguard']);\n  await exec.exec('sudo', ['ip', 'address', 'add', 'dev', 'wg0', clientIp, 'peer', gatewayIp]);\n  await exec.exec('sudo', ['wg', 'set', 'wg0', 'private-key', `${confDir}/privatekey`, 'peer', publicKey, 'allowed-ips', allowedIps, 'endpoint', endpoint]);\n  await exec.exec('sudo', ['ip', 'link', 'set', 'up', 'dev', 'wg0']);\n  core.info(`Connected`);\n} catch (error) {\n  core.setFailed(error.message);\n}\n"],"names":["core.getInput","core.info","exec.exec","io.mkdirP","fs","core.setFailed"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,IAAI;AACJ;AACA;AACA,EAAE,MAAM,OAAO,GAAGA,oBAAa,CAAC,UAAU,CAAC;AAC3C,EAAEC,gBAAS,CAAC,CAAC,4BAA4B,EAAE,OAAO,CAAC,CAAC,CAAC;AACrD,EAAE,MAAM,UAAU,GAAGD,oBAAa,CAAC,aAAa,CAAC;AACjD,EAAE,MAAM,SAAS,GAAGA,oBAAa,CAAC,YAAY,CAAC;AAC/C,EAAEC,gBAAS,CAAC,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC,CAAC;AACjD,EAAE,MAAM,QAAQ,GAAGD,oBAAa,CAAC,UAAU,CAAC;AAC5C,EAAEC,gBAAS,CAAC,CAAC,oBAAoB,EAAE,QAAQ,CAAC,CAAC,CAAC;AAC9C,EAAE,MAAM,UAAU,GAAGD,oBAAa,CAAC,aAAa,CAAC;AACjD,EAAEC,gBAAS,CAAC,CAAC,uBAAuB,EAAE,UAAU,CAAC,CAAC,CAAC;AACnD,EAAE,MAAM,QAAQ,GAAGD,oBAAa,CAAC,WAAW,CAAC;AAC7C,EAAEC,gBAAS,CAAC,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC,CAAC;AAC/C,EAAE,MAAM,SAAS,GAAGD,oBAAa,CAAC,YAAY,CAAC;AAC/C,EAAEC,gBAAS,CAAC,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC,CAAC;;AAEjD,EAAEA,gBAAS,CAAC,CAAC,oBAAoB,CAAC,CAAC;AACnC,EAAE,MAAMC,gBAAS,CAAC,MAAM,EAAE,CAAC,SAAS,EAAE,IAAI;AAC1C,IAAI,KAAK,EAAE,IAAI,EAAE,0BAA0B,EAAE,IAAI,EAAE,gBAAgB,EAAE,IAAI,EAAE,mBAAmB;AAC9F,IAAI,SAAS,EAAE,WAAW,EAAE,iBAAiB,CAAC,CAAC;AAC/C,EAAE,MAAMC,gBAAS,CAAC,OAAO,CAAC;AAC1B,EAAEC,UAAE,CAAC,aAAa,CAAC,CAAC,EAAE,OAAO,CAAC,WAAW,CAAC,EAAE,UAAU,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;;AAExE,EAAEH,gBAAS,CAAC,CAAC,UAAU,CAAC,CAAC;AACzB;;AAEA,EAAE,MAAMC,gBAAS,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;AACnF,EAAE,MAAMA,gBAAS,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,CAAC,CAAC;AAC9F,EAAE,MAAMA,gBAAS,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,aAAa,EAAE,CAAC,EAAE,OAAO,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,aAAa,EAAE,UAAU,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC;AAC3J,EAAE,MAAMA,gBAAS,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;AACpE,EAAED,gBAAS,CAAC,CAAC,SAAS,CAAC,CAAC;AACxB,CAAC,CAAC,OAAO,KAAK,EAAE;AAChB,EAAEI,qBAAc,CAAC,KAAK,CAAC,OAAO,CAAC;AAC/B"}