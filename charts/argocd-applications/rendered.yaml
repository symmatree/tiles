---
# Source: argocd-applications/templates/tiles-appproject.yaml
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: "placeholder"
  namespace: argocd
spec:
  description: "placeholder Project"
  sourceRepos:
    - https://github.com/symmatree/tiles.git
  destinations:
    - server: https://kubernetes.default.svc
      namespace: '*'
  # Allow creating all types of cluster-scoped resources...
  clusterResourceWhitelist:
  - group: '*'
    kind: '*'
  # ...except CRDs because then cert-manager tries to nuke them.
  clusterResourceBlacklist:
  - group: 'apiextensions.k8s.io/v1'
    kind: 'CustomResourceDefinition'
---
# Source: argocd-applications/templates/alloy-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: alloy
  namespace: argocd
  labels:
    name: alloy
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/alloy
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: "placeholder"
        cluster_name: "placeholder"
        k8s-monitoring:
          cluster:
            name: "placeholder"

          # Arrays don't value-merge so we have to do it all here.
          destinations:
            - name: localMimir
              type: prometheus
              url: http://mimir-distributor-headless.mimir.svc:8080/api/v1/push
              tenantId: "placeholder"
              secret:
                # This is just the tenant name
                create: false
                embed: true
            - name: localLoki
              type: loki
              url: http://loki-gateway.loki.svc/loki/api/v1/push
              tenantId: "placeholder"
              http_user: "placeholder"
              secret:
                # This is just the tenant name
                create: false
                embed: true
              http_passwd:
                secret:
                  name: loki-tenant-auth
                  key: password

  destination:
    server: https://kubernetes.default.svc
    namespace: alloy
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
        trust-bundle: enabled
---
# Source: argocd-applications/templates/argocd-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd
  namespace: argocd
  labels:
    name: argocd
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/argocd
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        targetRevision: "main"
        argo-cd:
          global:
            domain: "argocd.placeholder.symmatree.com"
          server:
            ingressGrpc:
              hostname: "grpc-argocd.placeholder.symmatree.com"
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
      - FailOnSharedResource=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/argocd-applications-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd-applications
  namespace: argocd
  labels:
    name: argocd-applications
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/argocd-applications
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        # Propagate to other application.yaml files
        targetRevision: "main"
        pod_cidr: "placeholder"
        cluster_name: "placeholder"
        external_ip_cidr: "placeholder-external-ip-cidr"
        vault_name: "placeholder"
        project_id: "placeholder-project-id"
        loki_bucket_chunks: "placeholder-loki-bucket-chunks"
        loki_bucket_ruler: "placeholder-loki-bucket-ruler"
        loki_bucket_admin: "placeholder-loki-bucket-admin"
        mimir_bucket_alertmanager: "placeholder-mimir-bucket-alertmanager"
        mimir_bucket_blocks: "placeholder-mimir-bucket-blocks"
        mimir_bucket_ruler: "placeholder-mimir-bucket-ruler"
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
      - FailOnSharedResource=true
---
# Source: argocd-applications/templates/cert-manager-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cert-manager
  namespace: argocd
  labels:
    name: cert-manager
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/cert-manager
    helm:
      skipCrds: true
      valueFiles:
        - values.yaml
      valuesObject:
        cluster_name: "placeholder"
        project_id: "placeholder-project-id"
        vault_name: "placeholder"
        trust-manager:
          secretTargets:
            authorizedSecrets:
              - "placeholder-ca-tls"
  destination:
    server: https://kubernetes.default.svc
    namespace: cert-manager
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/cilium-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cilium
  namespace: argocd
  labels:
    name: cilium
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/cilium
    helm:
      valueFiles:
        - values.yaml
      # Inject values from Terraform or that vary by environment.
      valuesObject:
        cilium:
          ipv4NativeRoutingCIDR: "placeholder"
          cluster:
            name: "placeholder"
          hubble:
            tls:
              auto:
                certManagerIssuerRef:
                  name: "placeholder-ca-issuer"
            ui:
              ingress:
                hosts:
                  - "hubble.placeholder.symmatree.com"
                tls:
                  - secretName: hubble-ui-tls
                    hosts:
                      - "hubble.placeholder.symmatree.com"
  destination:
    server: https://kubernetes.default.svc
    namespace: cilium
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
---
# Source: argocd-applications/templates/cilium-config-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cilium-config
  namespace: argocd
  labels:
    name: cilium-config
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/cilium-config
    helm:
      # Inject values from Terraform or that vary by environment.
      valuesObject:
        external_ip_cidr: "placeholder-external-ip-cidr"
        targetRevision: "main"
  destination:
    server: https://kubernetes.default.svc
    namespace: cilium
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
---
# Source: argocd-applications/templates/external-dns-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: external-dns
  namespace: argocd
  labels:
    name: external-dns
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/external-dns
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        cluster_name: "placeholder"
        project_id: "placeholder-project-id"
        vault_name: "placeholder"
        external-dns:
          txtOwnerId: "placeholder"
          domainFilters:
            - "placeholder.symmatree.com"
            - 0.10.in-addr.arpa
          extraArgs:
            - "--google-project=placeholder-project-id"
  destination:
    server: https://kubernetes.default.svc
    namespace: external-dns
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/grafana-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: grafana
  namespace: argocd
  labels:
    name: grafana
spec:
  project: default
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/grafana
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: "placeholder"
        cluster_name: "placeholder"
        grafana:
          ingress:
            hosts:
              - borgmon.placeholder.symmatree.com
            tls:
              - secretName: grafana-tls
                hosts:
                  - borgmon.placeholder.symmatree.com
  destination:
    server: https://kubernetes.default.svc
    namespace: grafana
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
        trust-bundle: enabled
---
# Source: argocd-applications/templates/local-path-provisioner-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: local-path-provisioner
  namespace: argocd
  labels:
    name: local-path-provisioner
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/local-path-provisioner
    helm:
      valueFiles:
        - values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: local-path-provisioner
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
---
# Source: argocd-applications/templates/loki-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: loki
  namespace: argocd
  labels:
    name: loki
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/loki
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: "placeholder"
        cluster_name: "placeholder"
        loki:
          loki:
            storage:
              bucketNames:
                chunks: "placeholder-loki-bucket-chunks"
                ruler: "placeholder-loki-bucket-ruler"
                admin: "placeholder-loki-bucket-admin"
  destination:
    server: https://kubernetes.default.svc
    namespace: loki
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/mimir-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: mimir
  namespace: argocd
  labels:
    name: mimir
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/mimir
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: "placeholder"
        cluster_name: "placeholder"
        mimir-distributed:
          mimir:
            structuredConfig:
              alertmanager_storage:
                gcs:
                  bucket_name: "placeholder-mimir-bucket-alertmanager"
              blocks_storage:
                gcs:
                  bucket_name: "placeholder-mimir-bucket-blocks"
              ruler_storage:
                gcs:
                  bucket_name: "placeholder-mimir-bucket-ruler"
          ingress:
            hosts:
              - mimir.placeholder.symmatree.com
            tls:
              - secretName: mimir-tls
                hosts:
                  - mimir.placeholder.symmatree.com
  destination:
    server: https://kubernetes.default.svc
    namespace: mimir
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/onepassword-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: onepassword
  namespace: argocd
  labels:
    name: onepassword
spec:
  project: "placeholder"
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: "main"
    path: charts/onepassword
    helm:
      valueFiles:
        - values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: onepassword
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
