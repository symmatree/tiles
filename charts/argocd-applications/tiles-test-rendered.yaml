---
# Source: argocd-applications/templates/alloy-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: alloy
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/alloy
    helm:
      version: v3
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: 'placeholder'
        cluster_name: 'tiles-test'
        k8s-monitoring:
          cluster:
            name: 'tiles-test'

          # Arrays don't value-merge so we have to do it all here.
          destinations:
            - name: localMimir
              type: prometheus
              url: http://mimir-gateway.mimir.svc/api/v1/push
              tenantId: 'tiles-test'
              secret:
                # This is just the tenant name
                create: false
                embed: true
            - name: localLoki
              type: loki
              url: http://loki-gateway.loki.svc/loki/api/v1/push
              tenantId: 'tiles-test'
              secret:
                # This is just the tenant name
                create: false
                embed: true
          alloy-singleton:
            extraConfig: |-
              mimir.rules.kubernetes "default" {
                address = "http://mimir-gateway.mimir.svc"
                tenant_id = "tiles-test"
              }

  destination:
    server: https://kubernetes.default.svc
    namespace: alloy
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
        trust-bundle: enabled
---
# Source: argocd-applications/templates/apprise-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: apprise
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: tanka
    plugin:
      env:
        - name: TK_ENV
          value: apprise
      parameters:
        - name: cluster_name
          string: 'tiles-test'
        - name: vault_name
          string: 'placeholder'
        - name: project_id
          string: 'placeholder'
        - name: app_settings
          map:
            hostname: 'apprise.tiles-test.symmatree.com'
            cluster_issuer: "real-cert"
            apprise_env: 'tiles-test-apprise-env'
            apprise_admin: 'tiles-test-apprise-admin'
  destination:
    server: https://kubernetes.default.svc
    namespace: apprise
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/argocd-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/argocd
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        targetRevision: 'main'
        cluster_name: 'tiles-test'
        vault_name: 'placeholder'
        argo-cd:
          global:
            domain: 'argocd.tiles-test.symmatree.com'
          server:
            ingressGrpc:
              hostname: 'grpc-argocd.tiles-test.symmatree.com'
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
      - FailOnSharedResource=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/argocd-mixin-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd-mixin
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: tanka
    plugin:
      env:
        - name: TK_ENV
          value: argocd-mixin
      parameters:
        - name: cluster_name
          string: 'tiles-test'
        - name: vault_name
          string: 'placeholder'
        - name: project_id
          string: 'placeholder'
        - name: app_settings
          map: {}
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
---
# Source: argocd-applications/templates/cert-manager-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cert-manager
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/cert-manager
    helm:
      skipCrds: true
      valueFiles:
        - values.yaml
      valuesObject:
        cluster_name: 'tiles-test'
        project_id: 'placeholder'
        vault_name: 'placeholder'
        trust-manager:
          secretTargets:
            authorizedSecrets:
              - 'tiles-test-ca-tls'
  destination:
    server: https://kubernetes.default.svc
    namespace: cert-manager
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/cilium-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cilium
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/cilium
    helm:
      valueFiles:
        - values.yaml
      # Inject values from Terraform or that vary by environment.
      valuesObject:
        cilium:
          ipv4NativeRoutingCIDR: 'placeholder'
          cluster:
            name: 'tiles-test'
          hubble:
            tls:
              auto:
                certManagerIssuerRef:
                  name: 'tiles-test-ca-issuer'
            ui:
              ingress:
                hosts:
                  - 'hubble.tiles-test.symmatree.com'
                tls:
                  - secretName: hubble-ui-tls
                    hosts:
                      - 'hubble.tiles-test.symmatree.com'
  destination:
    server: https://kubernetes.default.svc
    namespace: cilium
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
---
# Source: argocd-applications/templates/cilium-config-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cilium-config
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/cilium-config
    helm:
      # Inject values from Terraform or that vary by environment.
      valuesObject:
        external_ip_cidr: 'placeholder'
        targetRevision: 'main'
  destination:
    server: https://kubernetes.default.svc
    namespace: cilium
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
---
# Source: argocd-applications/templates/cilium-mixin-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: cilium-mixin
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: tanka
    plugin:
      env:
        - name: TK_ENV
          value: cilium-mixin
      parameters:
        - name: cluster_name
          string: 'tiles-test'
        - name: vault_name
          string: 'placeholder'
        - name: project_id
          string: 'placeholder'
        - name: app_settings
          map: {}
  destination:
    server: https://kubernetes.default.svc
    namespace: cilium
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
---
# Source: argocd-applications/templates/external-dns-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: external-dns
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/external-dns
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        cluster_name: 'tiles-test'
        project_id: 'placeholder'
        vault_name: 'placeholder'
        external-dns:
          txtOwnerId: 'tiles-test'
          domainFilters:
            - 'tiles-test.symmatree.com'
            - 0.10.in-addr.arpa
          extraArgs:
            - '--google-project=placeholder'
            - '--regex-domain-exclusion=^_acme-challenge\.'
  destination:
    server: https://kubernetes.default.svc
    namespace: external-dns
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/grafana-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: grafana
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/grafana
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: 'placeholder'
        cluster_name: 'tiles-test'
        grafana:
          ingress:
            hosts:
              - 'borgmon.tiles-test.symmatree.com'
            tls:
              - secretName: grafana-tls
                hosts:
                  - 'borgmon.tiles-test.symmatree.com'
  destination:
    server: https://kubernetes.default.svc
    namespace: grafana
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
        trust-bundle: enabled
---
# Source: argocd-applications/templates/kubernetes-mixin-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kubernetes-mixin
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: tanka
    plugin:
      env:
        - name: TK_ENV
          value: kubernetes-mixin
      parameters:
        - name: cluster_name
          string: 'tiles-test'
        - name: vault_name
          string: 'placeholder'
        - name: project_id
          string: 'placeholder'
        - name: app_settings
          map: {}
  destination:
    server: https://kubernetes.default.svc
    namespace: alloy
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
---
# Source: argocd-applications/templates/local-path-provisioner-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: local-path-provisioner
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/local-path-provisioner
    helm:
      valueFiles:
        - values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: local-path-provisioner
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/enforce: privileged
        pod-security.kubernetes.io/warn: privileged
---
# Source: argocd-applications/templates/loki-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: loki
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/loki
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: 'placeholder'
        cluster_name: 'tiles-test'
        loki:
          loki:
            storage:
              bucketNames:
                chunks: 'placeholder'
                ruler: 'placeholder'
                admin: 'placeholder'
  destination:
    server: https://kubernetes.default.svc
    namespace: loki
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/mimir-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: mimir
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/mimir
    helm:
      valueFiles:
        - values.yaml
      valuesObject:
        vault_name: 'placeholder'
        cluster_name: 'tiles-test'
        mimir-distributed:
          mimir:
            structuredConfig:
              alertmanager_storage:
                gcs:
                  bucket_name: 'placeholder'
              blocks_storage:
                gcs:
                  bucket_name: 'placeholder'
              ruler_storage:
                gcs:
                  bucket_name: 'placeholder'
          gateway:
            ingress:
              hosts:
                - 'mimir.tiles-test.symmatree.com'
              tls:
                - secretName: mimir-tls
                  hosts:
                    - 'mimir.tiles-test.symmatree.com'
  destination:
    server: https://kubernetes.default.svc
    namespace: mimir
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
---
# Source: argocd-applications/templates/node-exporter-mixin-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: node-exporter-mixin
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: tanka
    plugin:
      env:
        - name: TK_ENV
          value: node-exporter-mixin
      parameters:
        - name: cluster_name
          string: 'tiles-test'
        - name: vault_name
          string: 'placeholder'
        - name: project_id
          string: 'placeholder'
        - name: app_settings
          map: {}
  destination:
    server: https://kubernetes.default.svc
    namespace: alloy
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
---
# Source: argocd-applications/templates/onepassword-application.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: onepassword
spec:
  project: 'tiles-test'
  source:
    repoURL: https://github.com/symmatree/tiles.git
    targetRevision: 'main'
    path: charts/onepassword
    helm:
      valueFiles:
        - values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: onepassword
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
    managedNamespaceMetadata:
      labels:
        pod-security.kubernetes.io/warn: baseline
